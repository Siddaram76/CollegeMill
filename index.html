<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Results Portal</title>
    <style>
        /* ... [Your CSS stays unchanged] ... */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>MILLENNIUM COMPOSITE PU COLLEGE , KALABURGI</h1>
            <p>Pre-University Student Results Portal</p>
            <div style="margin-top: 15px; font-size: 14px; opacity: 0.9;">
                Karnataka State Board â€¢ Science & Commerce 
            </div>
        </div>

        <div class="login-section" id="loginSection">
            <h2 style="margin-bottom: 30px; color: #1f2937;">PU Student Login</h2>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="rollNumber">Roll Number</label>
                    <input type="text" id="rollNumber" placeholder="Enter your roll number" required>
                </div>
                <div class="form-group">
                    <label for="course">Select Course</label>
                    <select id="course" required>
                        <option value="">Choose course...</option>
                        <option value="1st_pu">1st PU</option>
                        <option value="2nd_pu">2nd PU</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="stream">Select Stream</label>
                    <select id="stream" required>
                        <option value="">Choose stream...</option>
                        <option value="science">Science (PCMB/PCMCs)</option>
                        <option value="commerce">Commerce (CEBA)</option>
                    </select>
                </div>
                <button type="submit" class="btn">View Results</button>
            </form>
        </div>

        <div class="results-section" id="resultsSection" style="display:none;">
            <div class="student-info">
                <h2 class="section-title">Student Information</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <h4>Student Name</h4>
                        <p id="studentName">-</p>
                    </div>
                    <div class="info-item">
                        <h4>Roll Number</h4>
                        <p id="displayStudentId">-</p>
                    </div>
                    <div class="info-item">
                        <h4>Course</h4>
                        <p id="year">-</p>
                    </div>
                    <div class="info-item">
                        <h4>Stream</h4>
                        <p id="program">-</p>
                    </div>
                    <div class="info-item">
                        <h4>Academic Year</h4>
                        <p id="currentSemester">-</p>
                    </div>
                    <div class="info-item">
                        <h4>Status</h4>
                        <p id="status">-</p>
                    </div>
                </div>
            </div>

            <div class="grades-section">
                <h2 class="section-title">Academic Results</h2>
                <table class="grades-table">
                    <thead>
                        <tr>
                            <th>Subject Code</th>
                            <th>Subject Name</th>
                            <th>Max Marks</th>
                            <th>Marks Obtained</th>
                            <th>Grade</th>
                            <th>Result</th>
                        </tr>
                    </thead>
                    <tbody id="gradesTableBody">
                        <!-- Grades will be populated here -->
                    </tbody>
                </table>

                <div class="summary-cards">
                    <div class="summary-card">
                        <h3 id="totalMarks">0</h3>
                        <p>Total Marks</p>
                    </div>
                    <div class="summary-card">
                        <h3 id="obtainedMarks">0</h3>
                        <p>Marks Obtained</p>
                    </div>
                    <div class="summary-card">
                        <h3 id="percentage">0%</h3>
                        <p>Percentage</p>
                    </div>
                    <div class="summary-card">
                        <h3 id="result">-</h3>
                        <p>Overall Result</p>
                    </div>
                </div>
            </div>

            <button class="btn back-btn" onclick="showLogin()">Back to Login</button>
        </div>
    </div>

    <script>
        async function getResultsFromSheet(rollNumber) {
            try {
                const response = await fetch("https://script.google.com/macros/s/AKfycbx2WVC0Skb9B64tJoJwtNShQRWcvXBmFJtGBAC_VmfwQNx2pY5YFlYMBx7hVPeTFFXF/exec");
                const data = await response.json();
                return data.find(student => student["Roll No"].toUpperCase() === rollNumber);
            } catch (error) {
                console.error("Error fetching results:", error);
                return null;
            }
        }

        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const rollNumber = document.getElementById('rollNumber').value.trim().toUpperCase();
            const course = document.getElementById('course').value;
            const stream = document.getElementById('stream').value;

            // Fetch and match student
            const student = await getResultsFromSheet(rollNumber);

            if (student) {
                // Optional: If your sheet has these fields, validate them
                // if (student.Course !== course || student.Stream !== stream) {
                //     alert("Selected course and stream do not match your enrollment. Please check your selection.");
                //     return;
                // }

                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('resultsSection').style.display = 'block';

                document.getElementById('studentName').textContent = student.Name || "-";
                document.getElementById('displayStudentId').textContent = student["Roll No"] || "-";
                document.getElementById('year').textContent = student.Course || "-";
                document.getElementById('program').textContent = student.Stream || "-";
                document.getElementById('currentSemester').textContent = student["Academic Year"] || "2024-25";
                document.getElementById('status').textContent = student.Result || "-";

                // Subjects and marks
                // Adjust keys as per your Sheet's column headers
                const subjects = [
                    { code: "PHY", name: "Physics", markKey: "Physics" },
                    { code: "CHE", name: "Chemistry", markKey: "Chemistry" },
                    { code: "MAT", name: "Mathematics", markKey: "Maths" },
                    { code: "BIO", name: "Biology", markKey: "Biology" },
                    { code: "CS", name: "Computer Science", markKey: "Computer Science" },
                    { code: "ENG", name: "English", markKey: "English" },
                    { code: "KAN", name: "Kannada", markKey: "Kannada" },
                    { code: "ACC", name: "Accountancy", markKey: "Accountancy" },
                    { code: "BUS", name: "Business Studies", markKey: "Business Studies" },
                    { code: "STAT", name: "Statistics", markKey: "Statistics" },
                    { code: "ECO", name: "Economics", markKey: "Economics" }
                ];

                let tbody = document.getElementById('gradesTableBody');
                tbody.innerHTML = '';
                let totalMarks = 0;
                let obtainedMarks = 0;
                let subjectsCount = 0;
                let passCount = 0;

                subjects.forEach(subj => {
                    if (student[subj.markKey] !== undefined && student[subj.markKey] !== "") {
                        const marks = Number(student[subj.markKey]);
                        const maxMarks = 100;
                        const result = marks >= 35 ? "Pass" : "Fail";
                        const resultColor = marks >= 35 ? "#059669" : "#dc2626";
                        // Simple grade logic, adjust as needed
                        let grade = "-";
                        if (marks >= 90) grade = "A1";
                        else if (marks >= 80) grade = "A2";
                        else if (marks >= 70) grade = "B1";
                        else if (marks >= 60) grade = "B2";
                        else if (marks >= 50) grade = "C1";
                        else if (marks >= 35) grade = "C2";
                        else grade = "D";

                        tbody.innerHTML += `
                            <tr>
                                <td>${subj.code}</td>
                                <td>${subj.name}</td>
                                <td>${maxMarks}</td>
                                <td>${marks}</td>
                                <td><span class="grade-badge grade-${grade.toLowerCase()}">${grade}</span></td>
                                <td><span style="color:${resultColor};font-weight:600;">${result}</span></td>
                            </tr>
                        `;
                        totalMarks += maxMarks;
                        obtainedMarks += marks;
                        subjectsCount++;
                        if (marks >= 35) passCount++;
                    }
                });

                // If your sheet has total/percentage/result, use them, else calculate here
                document.getElementById('totalMarks').textContent = totalMarks;
                document.getElementById('obtainedMarks').textContent = obtainedMarks;
                document.getElementById('percentage').textContent = totalMarks ? ((obtainedMarks / totalMarks) * 100).toFixed(1) + '%' : "-";
                const overallResult = passCount === subjectsCount && subjectsCount > 0 ? "PASS" : "FAIL";
                document.getElementById('result').textContent = overallResult;

                // Update result card color
                const resultCard = document.getElementById('result').parentElement;
                if (overallResult === 'PASS') {
                    resultCard.style.background = 'linear-gradient(135deg, #059669 0%, #047857 100%)';
                } else {
                    resultCard.style.background = 'linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)';
                }

            } else {
                alert("No result found for this Roll Number.");
            }
        });

        function showLogin() {
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('loginForm').reset();
        }
    </script>
</body>
</html>
